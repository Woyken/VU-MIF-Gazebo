<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
        xmlns:c="http://java.sun.com/jsp/jstl/core"
>


    <!-- MAIN PAGE COVER. -->
    <div class="section section-cover hide-for-small-only"
         style="background: url(../../resources/images/main-page-cover-16-9-1.jpg);">
    </div> <!-- END OF MAIN PAGE COVER. -->


    <!-- PAGE TITLE. -->
    <div class="row medium-6 large-8 columns text-center section">
        <h1 class="section-title">PAGRINDINĖS PREKĖS</h1>
    </div> <!-- END OF PAGE TITLE. -->


    <!-- SEARCH ITEMS BAR. -->
    <div class="row small-8 medium-6 large-4 columns input-group-rounded margin-top-3" id="search">
        <section class="search-bar">
            <h:form>
                <div class="input-group">
                    <h:inputText id="searchInput" class="input-group-field" value="#{productController.productSearch.title}" placeholder="Atraskite save"/>
                    <div class="input-group-button">
                        <h:commandButton class="button" value="Ieškoti">
                            <f:ajax execute="searchInput" listener="#{productController.searchProducts()}" render="productList paging-form"/>
                        </h:commandButton>
                    </div>
                </div>
            </h:form>
        </section>
    </div> <!-- END OF SEARCH ITEMS BAR. -->

    <div class="row expanded">

        <!-- FILTERING. -->
        <aside class="product-filters medium-3 large-2 columns">
            <div class="hide-for-small-only" data-sticky-container="">
                <div class="sticky" data-sticky="" data-top-anchor="search">
                    <h3 class="product-filters-header hide-for-small-only margin-top-3"><br/>Rūšiuokite:</h3>
                    <ul class="vertical menu hide-for-small-only" data-accordion-menu="">
                        <li class="product-filters-tab margin-top-1">
                            <a href="#">Kategorija</a>
                            <ul class="categories-menu menu vertical nested is-active">
                                <li><input id="category-checkbox1" type="checkbox"/><label for="category-checkbox1">Category 1</label></li>
                                <li><input id="category-checkbox2" type="checkbox"/><label for="category-checkbox2">Category 2</label></li>
                                <li><input id="category-checkbox3" type="checkbox"/><label for="category-checkbox3">Category 3</label></li>
                                <li><input id="category-checkbox4" type="checkbox"/><label for="category-checkbox4">Category 4</label></li>
                                <li><input id="category-checkbox5" type="checkbox"/><label for="category-checkbox5">Category 5</label></li>
                            </ul>
                        </li>
                        <li class="product-filters-tab margin-top-1">
                            <a href="#">Kaina</a>
                            <ul class="categories-menu menu vertical nested is-active">
                                <li><input id="price-checkbox1" type="checkbox"/><label for="price-checkbox1">Under $25</label></li>
                                <li><input id="price-checkbox2" type="checkbox"/><label for="price-checkbox2">$25–$50</label></li>
                                <li><input id="price-checkbox3" type="checkbox"/><label for="price-checkbox3">$50–$250</label></li>
                                <li><input id="price-checkbox4" type="checkbox"/><label for="price-checkbox4">$250–$600</label></li>
                                <li><input id="price-checkbox5" type="checkbox"/><label for="price-checkbox5">$600–$1,000</label></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </aside> <!-- END OF FILTERING. -->


        <!-- PRODUCT LIST. -->
        <div class="small-12 medium-9 large-8 columns">
            <h:panelGroup id="productList">
                <ui:repeat value="#{productController.productsPage.content}" var="productItem" varStatus="loop">
                    <h:outputText value="&lt;div class='row small-up-2 large-up-4 section'&gt;"
                                  escape="false" rendered="#{loop.index % 4 == 0}"/>

                    <div class="column product-box">
                        <!-- Product image -->
                        <a href="../../product-details.xhtml?productId=#{productItem.id}">
                            <p:graphicImage class="thumbnail" value="#{imageStreamer.image}">
                                <f:param name="id" value="#{productItem.images.get(0).id}"/>
                            </p:graphicImage>
                        </a>

                        <!-- Product name -->
                        <h5 class="product-name bor-bot">#{productItem.title}</h5>

                        <!-- Product price -->
                        <p class="product-price">€ #{productItem.price}</p>

                        <!-- [Button] To cart -->
                        <h:form>
                            <h:commandButton class="button expanded primary"
                                             value="PRIDĖTI Į KREPŠELĮ"
                                             pt:data-open="inform-user-about-adding-to-cart-modal"
                                             actionListener="#{cartController.addProductToCart(productItem.id)}">
                                <f:ajax execute="@form" render="@none"/>
                            </h:commandButton>
                        </h:form>

                        <!-- [Button][Admin] Edit product -->
                        <c:choose>
                            <c:when test="#{UserService.isLoggedIn()}">
                                <c:choose>

                                    <!-- Admin logged in -->
                                    <c:when test="#{UserService.getLoggedUser().getRole() == 'ADMIN'}">
                                        <a href="../../admin-edit-product.xhtml?productId=#{productItem.id}"
                                           class="button expanded">
                                            Redaguoti prekę
                                        </a>
                                    </c:when>

                                </c:choose>
                            </c:when>
                        </c:choose>

                    </div>
                    <h:outputText value="&lt;/div&gt;" escape="false"
                                  rendered="#{loop.last or (loop.index + 1) % 4 == 0}"/>
                </ui:repeat>
            </h:panelGroup>
        </div> <!-- END OF PRODUCT LIST. -->
    </div>

    <!--PAGING-->
    <h:form id="paging-form">
        <nav aria-label="Pagination">
            <ul class="pagination text-center">
                <li class="pagination-previous">
                    <h:commandLink value="Atgal" disabled="#{productController.pagingIndex eq 0 and productController.paging.activePage eq 0}">
                        <f:ajax execute="@form" listener="#{productController.previous}" render="productList paging-form"/>
                    </h:commandLink>
            </li>
                <ui:repeat value="#{productController.paging.totalPages}" var="page" varStatus="status" size="#{productController.paging.minValue}">
                    <li>
                        <h:commandLink rendered="#{(status.index + 1 + productController.pagingIndex) le productController.productsPage.totalPages}"
                                       value="#{status.index + 1 + productController.pagingIndex}"
                                       styleClass="#{status.index + productController.pagingIndex eq productController.paging.activePage ? 'current' : ''}">
                            <f:ajax execute="@form" listener="#{productController.searchProducts(status.index + productController.pagingIndex)}"
                                    render="productList paging-form"/>
                        </h:commandLink>
                    </li>
                </ui:repeat>
                <li class="pagination-next">
                    <h:commandLink value="Pirmyn" disabled="#{productController.paging.activePage + productController.paging.index + 1 eq productController.productsPage.totalPages}">
                        <f:ajax execute="@form" listener="#{productController.next}" render="productList paging-form"/>
                    </h:commandLink>
                </li>
            </ul>
        </nav>
    </h:form>
    <!--PAGING-->

    <!-- INFORM USER ABOUT ADDING TO CART MODAL -->
    <div id="inform-user-about-adding-to-cart-modal"
         class="reveal"
         data-reveal=""
         data-overlay="false"
         data-animation-in="fade-in fast">
        <div class="row">
            <div class="columns small-8 small-offset-2">
                <h4 class="form-title text-center">
                    Prekė pridėta prie jūsų krepšelio
                </h4>
                <br />
                <div class="row">
                    <div class="columns small-12">
                        <a class="button orange expanded" data-close="">Supratau</a>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- END OF INFORM USER ABOUT ADDING TO CART MODAL -->


</ui:composition>